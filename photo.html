<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å©šç¤¼ç°åœºç…§ç‰‡ - ç²¾ä¿®ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 20px;
        }
        
        .photo-item {
            aspect-ratio: 4/3;
            overflow: hidden;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .photo-item:active img {
            transform: scale(0.95);
        }
        
        .preview-modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
        }
        
        .preview-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .close-btn {
            position: absolute;
            top: 15px; right: 15px;
            color: white;
            font-size: 20px;
            background: rgba(0,0,0,0.5);
            width: 35px; height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            border: none;
        }
        
        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 20px;
            background: rgba(0,0,0,0.5);
            width: 35px; height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            z-index: 1001;
        }
        
        .prev-btn { left: 15px; }
        .next-btn { right: 15px; }
        
        .counter {
            position: absolute;
            top: 15px; left: 15px;
            color: white;
            font-size: 12px;
            background: rgba(0,0,0,0.5);
            padding: 4px 10px;
            border-radius: 12px;
        }
        
        .loading {
            text-align: center;
            color: white;
            padding: 40px 20px;
        }
        
        .error {
            text-align: center;
            color: #ff6b6b;
            padding: 40px 20px;
            background: rgba(255,255,255,0.9);
            margin: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ’• å©šç¤¼ç°åœºç…§ç‰‡ - ç²¾ä¿®ç‰ˆ ğŸ’•</h1>
        <div class="subtitle">æ»‘åŠ¨æµè§ˆç¾å¥½å›å¿† Â· è‡ªåŠ¨åŠ è½½æ‰€æœ‰å›¾ç‰‡</div>
    </div>
    
    <div class="container">
        <div class="photo-grid" id="photoGrid">
            <div class="loading">æ­£åœ¨åŠ è½½å›¾ç‰‡...</div>
        </div>
    </div>
    
    <div class="preview-modal" id="previewModal">
        <button class="close-btn" onclick="closePreview()">Ã—</button>
        <div class="counter" id="imageCounter">1 / 0</div>
        <button class="nav-btn prev-btn" onclick="changeImage(-1)">â€¹</button>
        <div class="preview-content">
            <img class="preview-img" id="previewImage" src="" alt="">
        </div>
        <button class="nav-btn next-btn" onclick="changeImage(1)">â€º</button>
    </div>
    
    <script>
        // OSSé…ç½® - æ ¹æ®æ‚¨çš„è·¯å¾„ä¿®æ”¹
        const OSS_CONFIG = {
            bucket: 'edu-7516',
            region: 'oss-cn-beijing',
            folder: 'å©šç¤¼ç°åœº/ç²¾ä¿®/'  // æ‚¨çš„æ–‡ä»¶å¤¹è·¯å¾„
        };
        
        const OSS_BASE_URL = `https://${OSS_CONFIG.bucket}.${OSS_CONFIG.region}.aliyuncs.com/`;
        let allImages = [];
        let currentImageIndex = 0;
        
        // å¸¸è§çš„å›¾ç‰‡æ‰©å±•å
        const IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.webp', '.gif', '.bmp', '.JPG', '.JPEG', '.PNG', '.WEBP', '.GIF', '.BMP'];
        
        // æ¨¡æ‹Ÿè·å–æ–‡ä»¶å¤¹æ–‡ä»¶åˆ—è¡¨ï¼ˆå®é™…éœ€è¦åç«¯APIæ”¯æŒï¼‰
        async function loadImageList() {
            try {
                // æ–¹æ¡ˆ1: å¦‚æœæ‚¨æœ‰å·²çŸ¥çš„æ–‡ä»¶åˆ—è¡¨
                const knownImages = await loadKnownImages();
                
                // æ–¹æ¡ˆ2: å¦‚æœéœ€è¦è‡ªåŠ¨æ‰«æï¼Œéœ€è¦åç«¯APIæ”¯æŒ
                // const scannedImages = await scanFolderAPI();
                
                allImages = knownImages;
                renderPhotoGrid();
                
            } catch (error) {
                console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', error);
                showError('åŠ è½½å›¾ç‰‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ–¹æ¡ˆ1: æ‰‹åŠ¨æŒ‡å®šå·²çŸ¥å›¾ç‰‡åˆ—è¡¨ï¼ˆä¿®æ”¹è¿™é‡Œä¸ºæ‚¨å®é™…çš„å›¾ç‰‡ï¼‰
        async function loadKnownImages() {
            // è¿™é‡Œåˆ—å‡ºæ‚¨OSSæ–‡ä»¶å¤¹ä¸­å®é™…å­˜åœ¨çš„å›¾ç‰‡æ–‡ä»¶å
            // æ‚¨å¯ä»¥é€šè¿‡OSSæ§åˆ¶å°æŸ¥çœ‹å…·ä½“çš„æ–‡ä»¶å
            const imageFiles = [
                '8F2A0003.jpg',


'8F2A0072.jpg',


'8F2A0100.jpg',


'8F2A0159.jpg',


'8F2A0245.jpg',


'8F2A0578.jpg',


'8F2A0582.jpg',


'8F2A0596.jpg',


'8F2A0608.jpg',


'8F2A0630.jpg',


'8F2A0636.jpg',


'8F2A0637.jpg',


'8F2A0644.jpg',


'8F2A0656.jpg',


'8F2A0661.jpg',


'8F2A0675.jpg',


'8F2A0687.jpg',


'8F2A0752.jpg',


'8F2A0761.jpg',


'8F2A0770.jpg',


'8F2A0797.jpg',


'8F2A0820.jpg',


'8F2A0836.jpg',


'8F2A0869.jpg',


'8F2A0875.jpg',


'8F2A0907.jpg',


'8F2A0936.jpg',


'8F2A1187.jpg',


'8F2A1331.jpg',


'8F2A1338.jpg',


'8F2A1360.jpg',


'8F2A1412.jpg',


'8F2A1493.jpg',


'8F2A1534.jpg',


'8F2A1569.jpg',


'8F2A1609.jpg',


'8F2A1636.jpg',


'8F2A1651.jpg',


'8F2A1792.jpg',


'8F2A1801.jpg',


'8F2A1811.jpg',


'8F2A1885.jpg',


'8F2A1925.jpg',


'8F2A1946.jpg',


'8F2A1969.jpg',


'8F2A2067.jpg',


'8F2A2080.jpg',


'8F2A2146.jpg',


'8F2A2212.jpg',


'8F2A2226.jpg'


                // ç»§ç»­æ·»åŠ æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶å...
            ];
            
            return imageFiles.map(filename => ({
                filename: filename,
                url: OSS_BASE_URL + encodeURIComponent(OSS_CONFIG.folder + filename),
                title: 'å©šç¤¼ç°åœºç…§ç‰‡'
            }));
        }
        
        // æ–¹æ¡ˆ2: å¦‚æœéœ€è¦è‡ªåŠ¨æ‰«ææ–‡ä»¶å¤¹ï¼Œéœ€è¦åç«¯APIï¼ˆç¤ºä¾‹ä»£ç ï¼‰
        async function scanFolderAPI() {
            // è¿™é‡Œéœ€è¦æ‚¨è‡ªå·±å®ç°ä¸€ä¸ªåç«¯APIæ¥æ‰«æOSSæ–‡ä»¶å¤¹
            // ç¤ºä¾‹APIè°ƒç”¨
            const response = await fetch('/api/oss-list?folder=' + encodeURIComponent(OSS_CONFIG.folder));
            const data = await response.json();
            return data.files.filter(file => 
                IMAGE_EXTENSIONS.some(ext => file.name.endsWith(ext))
            ).map(file => ({
                filename: file.name,
                url: OSS_BASE_URL + encodeURIComponent(OSS_CONFIG.folder + file.name),
                title: 'å©šç¤¼ç°åœºç…§ç‰‡'
            }));
        }
        
        // æ¸²æŸ“å›¾ç‰‡ç½‘æ ¼
        function renderPhotoGrid() {
            const grid = document.getElementById('photoGrid');
            
            if (allImages.length === 0) {
                grid.innerHTML = '<div class="error">æœªæ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶</div>';
                return;
            }
            
            grid.innerHTML = '';
            
            allImages.forEach((image, index) => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.innerHTML = `
                    <img 
                        src="${image.url}" 
                        alt="${image.title}"
                        loading="lazy"
                        onclick="openPreview(${index})"
                        onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'color:#999;text-align:center;padding:20px\'>åŠ è½½å¤±è´¥</div>'"
                    >
                `;
                grid.appendChild(item);
            });
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = `<div class="error">${message}</div>`;
        }
        
        // æ‰“å¼€é¢„è§ˆ
        function openPreview(index) {
            currentImageIndex = index;
            updatePreviewImage();
            document.getElementById('previewModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // å…³é—­é¢„è§ˆ
        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // åˆ‡æ¢å›¾ç‰‡
        function changeImage(direction) {
            currentImageIndex += direction;
            if (currentImageIndex < 0) currentImageIndex = allImages.length - 1;
            if (currentImageIndex >= allImages.length) currentImageIndex = 0;
            updatePreviewImage();
        }
        
        // æ›´æ–°é¢„è§ˆå›¾ç‰‡
        function updatePreviewImage() {
            const img = document.getElementById('previewImage');
            const counter = document.getElementById('imageCounter');
            if (allImages[currentImageIndex]) {
                img.src = allImages[currentImageIndex].url;
                counter.textContent = `${currentImageIndex + 1} / ${allImages.length}`;
            }
        }
        
        // é”®ç›˜å¯¼èˆª
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('previewModal').style.display === 'block') {
                if (e.key === 'ArrowLeft') changeImage(-1);
                if (e.key === 'ArrowRight') changeImage(1);
                if (e.key === 'Escape') closePreview();
            }
        });
        
        // è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
        let startX = 0;
        const previewContent = document.querySelector('.preview-content');
        
        previewContent.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
        });
        
        previewContent.addEventListener('touchend', (e) => {
            const endX = e.changedTouches[0].clientX;
            const diff = startX - endX;
            
            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    changeImage(1);
                } else {
                    changeImage(-1);
                }
            }
        });
        
        // åˆå§‹åŒ–åŠ è½½
        loadImageList();
    </script>
</body>
</html>